<!doctype html>
<html>
  <head>
    <title>Fantasy AGE Dice Roller</title>
    <style>
        li {
            padding: 0;
            list-style-type: none;
            margin: 0;
        }
        span {
            padding: 0;
        }
        #results .dice {
            font-size: 3em;
        }

        #results .stunt {
            color: black;
            background-color: red;
        }

    </style>
  </head>
  <body>
      <div id="dice">
      <button id="roll">Roll</button>
      <ul id="results"></ul>
    </div>
    
      <form id="register">
        <label>Username</label><input id="username" type="text"/>
        <input type="submit">
      </form>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = io();
        let tpl = (msg) => `
        <li>
        <span class="description">${msg.user} rolled: </span>
        <span class="dice">${msg.dice[0]}</span>
        <span class="dice">${msg.dice[1]}</span>
        <span class="dice stunt">${msg.dice[2]}</span>
        <span class="result"> for ${msg.sum} points! ${ msg.stunt ? `with ${msg.stuntPoints} stunt points!` : '' }</span>
        </li>`;

        $(function() {
            $("#dice").hide();

            $('#roll').click(function() {
                socket.emit('roll', { username: $("#username").val()});
                return false;
            });

            $("#register").submit(function(e) {
                socket.emit('register');
                $(this).hide();
                $("#dice").show();
                e.preventDefault();
            });

            socket.on('roll', function(msg) {
                $("#results").prepend(tpl(msg.eventInfo));
            });

            socket.on('register', function(msg) {
                console.log(msg);
            });
        });
    </script>
  </body>
</html>
